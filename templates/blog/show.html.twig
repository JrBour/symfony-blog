{% extends 'base.html.twig' %}
{% block body %}
  <header style="background: url('{{blog.image}}'); background-position: center;background-size: cover;" class="header_post">
      <h1>{{ blog.title }}</h1>
  </header>
  <p>{{ blog.description }}</p>
  <p>{{ blog.date|date("d-m-Y")  }}</p>

  {{form_start(form)}}
    <div class="form-group">
      {{form_row(form.content,{ 'attr' : {
        'class' : 'form-control'
      }})}}
    </div>
  {{form_row(form.submit,{ 'attr' : {
    'class' : 'btn btn-primary'
  }})}}
  {{form_end(form)}}

  {% if comments %}
    <div class="comments_list">
      {% for comment in comments %}
          <div class="comments">
            <div class="card-header">
              <img src="{{ comment.author.image}}" alt="" class="profil_picture_post">
            </div>
            <div class="card">
              <div class="card-body">
                <p class="card-text"><a href="{{ path('profil_user', {id : comment.author.id}) }}" class="profil" >{{ comment.author.username}}</a> {{ comment.content }}</p>
              </div>
            </div>
          </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
{% block javascripts %}
<script type="text/javascript">
    $('form[name="comment"]').on('submit', function(e){
      e.preventDefault();
      let dataComment = {};
      let url = window.location.href;
      let split = url.split('/');

      dataComment['content'] = $('#comment_content').val();

      $.ajax({
        method: "POST",
        url: `/blog/${parseFloat(split[split.length - 1])}`,
        data : dataComment,
      }).done(function(response){
        console.log(response['content']);

        $('#comment_content').val('');
        $('.comments_list').append(`<div class="comments">
          <div class="card-header">
            <img src="${response['image']}" alt="" class="profil_picture_post">
          </div>
          <div class="card">
            <div class="card-body">
              <p class="card-text"><a href="/profil/${response['id']}" class="profil" >${response['username']}</a> ${response['content']} </p>
            </div>
          </div>
        </div>`);
      })
    });
</script>
{% endblock %}
